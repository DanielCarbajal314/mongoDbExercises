// PARA CREAR INDICES SPACIALES
db.COLECCION.createIndex({ CAMPO_GEO_ESPACIL : "2dsphere" } )


db.shipwrecks.aggregate([
    { 
        $match : {  
            coordinates: {   
                $geoWithin: {    
                    $center : [[ -75.4806715, 35.6656032 ], 1000/6378.1 ]         
                }     
            } 
        } 
    },
    {
        $merge : { into : "washintong" }
    }
])


db.puntoEnArequipa.aggregate([
    { 
        $match : {  
            address: {   
                $geoWithin: {    
                    $geometry : 
                    {
                        type: "Polygon",
                        coordinates:[[[-75.07332610944235,-15.442941608014523],[-75.04965210942034,-15.434503608006674],[-75.00387973437769,-15.330230357909564],[-74.96820073434448,-15.299422232880879],[-74.93986510931808,-15.206011732793893],[-74.87060198425358,-15.151229107742875],[-74.81591798420264,-15.139497732731936],[-74.76229860915272,-15.09805485769335],[-74.71860498411202,-15.135662982728377],[-74.60597223400713,-15.148497607740325],[-74.55252073395734,-15.139941232732351],[-74.45142135886319,-15.175972732765905],[-74.3987197338141,-15.181463232771021],[-74.387878358804,-15.251779607836493],[-74.4094619838241,-15.308493607889314],[-74.30971848373119,-15.358937232936293],[-74.32843135874862,-15.390993732966146],[-74.30012360872226,-15.47839460804754],[-74.19374085862317,-15.491660108059891],[-74.1512603585836,-15.428750983001317],[-74.09452060853076,-15.392003107967096],[-74.03729248347742,-15.456077608026764],[-74.08493035852183,-15.591535608152904],[-74.06864923350663,-15.629886608188615],[-73.94596098339234,-15.490403108058722],[-73.86827085831995,-15.426130232998862],[-73.8748627333261,-15.355065357932698],[-73.86005398331228,-15.326117482905728],[-73.80799098326376,-15.324274982904011],[-73.75886535821796,-15.385265357960808],[-73.68436435814851,-15.43748360800944],[-73.65161135811796,-15.416278857989692],[-73.5574036080301,-15.408611482982538],[-73.44290160792325,-15.35611910793365],[-73.39216610787585,-15.398736982973318],[-73.29452510778464,-15.392330107967334],[-73.28491973277569,-15.294937107876633],[-73.24593348273923,-15.286091857868389],[-73.17454523267247,-15.306607232887476],[-73.11683660761845,-15.222851607809472],[-73.11074823261278,-15.186106732775247],[-73.04756160755359,-15.134347857727025],[-73.004241982513,-15.064126982661612],[-72.9866562324965,-14.956103357561013],[-73.0314636075385,-14.900051107508839],[-73.00278473251163,-14.814986232429602],[-72.94272610745533,-14.765414357383417],[-72.84682460736528,-14.759823857378157],[-72.82857510734813,-14.702628107324887],[-72.7896957323116,-14.650213232276062],[-72.72470860725043,-14.675900482299905],[-72.64482110717515,-14.667281107291819],[-72.57724760711137,-14.686616857309744],[-72.47177123201166,-14.661398857286095],[-72.48612973202525,-14.712543482333754],[-72.47094735701083,-14.774774607391675],[-72.40647885694973,-14.827085482440271],[-72.31544485686328,-14.833863232446383],[-72.25228885680316,-14.803659482418112],[-72.14469910670047,-14.777712857393622],[-72.12869260668514,-14.83060173244281],[-72.04712673160691,-14.875062982483891],[-72.03425598159463,-14.811989732425122],[-72.04186248160205,-14.694371232315635],[-71.9879149815503,-14.632949857258227],[-71.9412154815053,-14.685324607306772],[-71.95863348152201,-14.72801585734659],[-71.92400360648855,-14.789796857403925],[-71.89004985645579,-14.790873482404747],[-71.85208898141893,-14.888090107495014],[-71.79762273136612,-14.895981732502001],[-71.74595998131583,-14.939869982542472],[-71.7674561063366,-15.010523982608396],[-71.80295560637094,-15.06744098266162],[-71.66795348123938,-15.091896107683313],[-71.63602448120798,-15.13913923272698],[-71.58760073116052,-15.125595107713895],[-71.57062723114409,-15.061207232653802],[-71.51171110608603,-15.079447732670113],[-71.48587035606062,-15.059104857650878],[-71.50704960608184,-14.97627548257407],[-71.43081660600647,-14.998084107593396],[-71.37268048094839,-15.079110107667935],[-71.31562810589134,-15.120224982705263],[-71.26022523083627,-15.076908107664018],[-71.20684048078279,-15.071888982658333],[-71.14357760571875,-15.120560607702265],[-71.18038935575547,-15.162620482742165],[-71.16032860573486,-15.207768232783705],[-71.2018356057764,-15.245445232819618],[-71.16539760573929,-15.288882232859228],[-71.15115360572422,-15.363941232928694],[-71.1743316057472,-15.424456607985453],[-71.07174685564274,-15.449273108006102],[-71.03897098060976,-15.405165732964244],[-70.99395748056315,-15.454841608009149],[-71.01517485558448,-15.489165358041653],[-71.00817873057646,-15.56396860811096],[-70.91798398048242,-15.643800733182328],[-70.90013123046293,-15.712146733245207],[-70.93614198049937,-15.784839608313934],[-70.84327698040043,-15.923255858439164],[-70.8201981053753,-15.978467983489526],[-70.81256860536601,-16.0539608585593],[-70.85673523041258,-16.05633735856325],[-70.8750609804313,-16.09457773359944],[-70.85388185540678,-16.241466483735003],[-70.95701598051453,-16.308402983800903],[-70.98628998054512,-16.309946108803313],[-70.97524260553239,-16.412164733897875],[-70.95292648050832,-16.46098898394246],[-70.99245448054945,-16.495866733976175],[-71.0782699806394,-16.45856473394416],[-71.13951873070269,-16.47497373396107],[-71.24564360581176,-16.46686360895608],[-71.24479673081032,-16.550228109033544],[-71.279151855845,-16.61582185909525],[-71.28909298085443,-16.726457609198313],[-71.3275681058935,-16.752256359223086],[-71.3694304809362,-16.719676984193608],[-71.42549898099278,-16.740642609214095],[-71.44430548101145,-16.804674109273943],[-71.44063573100748,-16.86522673433021],[-71.38461298095005,-17.02111048447416],[-71.33942410590409,-17.021758984473873],[-71.30224610586565,-17.093851109540108],[-71.44095610600608,-17.2517166096896],[-71.4907989810563,-17.2850056097214],[-71.6903686062558,-17.211988484656235],[-71.81221773137591,-17.184310859631758],[-71.85772710642054,-17.158866859608484],[-71.92264560648398,-17.087505359542583],[-72.03899385659693,-17.017339734478053],[-72.07615660663281,-17.021160109481826],[-72.21152498176303,-16.902446734371967],[-72.28827673183648,-16.875253734346927],[-72.2954177318433,-16.82741548430242],[-72.35928348190424,-16.764152484243727],[-72.44721985698787,-16.703956609187912],[-72.54318998207886,-16.678058609163998],[-72.70904535723552,-16.652692734140647],[-72.77190398229475,-16.62880323411849],[-72.91629023243046,-16.520372234017643],[-72.98684698249669,-16.517435109014958],[-73.05334473255901,-16.48940273398889],[-73.15915685765808,-16.41992573392425],[-73.22499848271967,-16.412771233917606],[-73.30480960779428,-16.379739733886858],[-73.31420135780306,-16.338703108848645],[-73.45125585793106,-16.281307108795232],[-73.61992648308843,-16.230085358747537],[-73.69937123316251,-16.220703108738814],[-73.7278823581891,-16.195247608715107],[-73.86935423332096,-16.13554385865951],[-73.88938898333963,-16.10935210863512],[-74.03308110847352,-16.018058733550117],[-74.05445098349342,-15.954523108490942],[-74.16719073359845,-15.900853108440955],[-74.24159998366775,-15.878699358420322],[-74.27519985869904,-15.840464608384721],[-74.32790373374814,-15.848716733392415],[-74.39330285880907,-15.829308483374323],[-74.43929285885189,-15.79456048334198],[-74.46282960887379,-15.726521483278617],[-74.66127773405863,-15.65283585820999],[-74.74967960914095,-15.60038085816114],[-74.83074948421647,-15.567194983130237],[-74.90997310929025,-15.512113608078954],[-75.00684360938045,-15.460041108030461],[-75.07332610944235,-15.442941608014523]],[[-71.18558498075087,-16.3849887338786],[-71.10323335566576,-16.408702858898526],[-71.09644323065928,-16.350770983844512],[-71.19735723076313,-16.35690873385277],[-71.18558498075087,-16.3849887338786]]]
                    }
                }     
            } 
        } 
    }
])


// PARA BUSCAR OBJECTOS GEOESPACIALES QUE ESTEN A UNA DISTANCIA DE OTRO OBJETO GEOSPACIAL

db.puntoEnArequipa.find({
    address: {
        $near: {
            $geometry: {
                type: "Point" ,
                coordinates: [ -71.310731, -16.289661 ]
            },
            $maxDistance: 100000
        }
    }
})
